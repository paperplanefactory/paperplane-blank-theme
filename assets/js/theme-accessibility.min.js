const ACCESSIBILITY_CONFIG={autoApplySystemPreferences:{reducedMotion:!0,darkMode:!1,highContrast:!1,reducedTransparency:!1}};function detectReducedTransparencySupport(){const e=/Mac|iPad|iPhone|iPod/.test(navigator.userAgent),t=window.matchMedia('(prefers-reduced-transparency: reduce)'),a=window.matchMedia('(-apple-prefers-reduced-transparency: reduce)'),r=window.matchMedia('(prefers-contrast: more)');return t.matches||e&&a.matches||r.matches}const systemPreferences={isReduced:window.matchMedia('(prefers-reduced-motion: reduce)').matches,prefersDarkMode:window.matchMedia('(prefers-color-scheme: dark)').matches,prefersHighContrast:window.matchMedia('(prefers-contrast: more)').matches,prefersReducedTransparency:detectReducedTransparencySupport()},PREFERENCES_KEY='paperplane_user_preferences',COOKIE_NAME='paperplane_user_preferences';function addHours(e,t){return e.setTime(e.getTime()+60*t*60*1e3),e}function getPreferencesFromStorage(){try{return JSON.parse(localStorage.getItem(PREFERENCES_KEY))||{}}catch(e){return{}}}function savePreferencesToStorage(e){try{localStorage.setItem(PREFERENCES_KEY,JSON.stringify(e));const t=addHours(new Date,8760);document.cookie=COOKIE_NAME+"="+encodeURIComponent(JSON.stringify(e))+"; expires="+t.toUTCString()+"; path=/; SameSite=Lax"+('https:'===window.location.protocol?"; Secure":"")}catch(e){console.error('Errore nel salvataggio delle preferenze:',e)}}function updateAttributesFromPreferences(){const e=getPreferencesFromStorage();0===e.reduced_motion?(document.documentElement.setAttribute('data-reduced-motion','true'),document.querySelectorAll('.stoppable-js').forEach(e=>{e.pause&&e.pause()}),document.querySelectorAll('.animation-play-pause-js').forEach(e=>{e.classList.remove('pause'),e.classList.add('play'),e.setAttribute('aria-pressed','false')}),document.querySelectorAll('.paperplane-reduce-motion-js').forEach(e=>{e.setAttribute('aria-checked','false'),updateSwitchLabel(e)}),window.ThemeConfig.animation.duration=0,window.ThemeConfig.animation.durationCounter=0):(document.documentElement.removeAttribute('data-reduced-motion'),document.querySelectorAll('.stoppable-js').forEach(e=>{e.play&&e.play()}),document.querySelectorAll('.animation-play-pause-js').forEach(e=>{e.classList.add('pause'),e.classList.remove('play'),e.setAttribute('aria-pressed','true')}),document.querySelectorAll('.paperplane-reduce-motion-js').forEach(e=>{e.setAttribute('aria-checked','true'),updateSwitchLabel(e)}),window.ThemeConfig.animation.duration=500,window.ThemeConfig.animation.durationCounter=1500),1===e.dark_mode?(document.documentElement.setAttribute('data-theme','dark'),document.querySelectorAll('.paperplane-darkmode-js').forEach(e=>{e.setAttribute('aria-checked','true'),updateSwitchLabel(e)})):(document.documentElement.setAttribute('data-theme','light'),document.querySelectorAll('.paperplane-darkmode-js').forEach(e=>{e.setAttribute('aria-checked','false'),updateSwitchLabel(e)})),1===e.reduced_transparency?(document.documentElement.setAttribute('data-reduced-transparency','true'),document.querySelectorAll('.paperplane-reduce-transparency-js').forEach(e=>{e.setAttribute('aria-checked','true'),updateSwitchLabel(e)})):(document.documentElement.removeAttribute('data-reduced-transparency'),document.querySelectorAll('.paperplane-reduce-transparency-js').forEach(e=>{e.setAttribute('aria-checked','false'),updateSwitchLabel(e)}))}function savePreference(e,t){const a=getPreferencesFromStorage();a[e]=t,savePreferencesToStorage(a),updateAttributesFromPreferences()}function updateSwitchLabel(e){const t='true'===e.getAttribute('aria-checked'),a=e.querySelector('.paperplane-switch-label');a&&(a.textContent=t?'On':'Off')}function syncButtonsWithCurrentDOM(){let e=document.documentElement.hasAttribute('data-reduced-motion'),t='dark'===document.documentElement.getAttribute('data-theme'),a=document.documentElement.hasAttribute('data-reduced-transparency');if(ACCESSIBILITY_CONFIG.autoApplySystemPreferences.reducedMotion&&systemPreferences.isReduced&&(e=!0,document.documentElement.setAttribute('data-reduced-motion','true')),ACCESSIBILITY_CONFIG.autoApplySystemPreferences.darkMode&&systemPreferences.prefersDarkMode&&(t=!0,document.documentElement.setAttribute('data-theme','dark')),ACCESSIBILITY_CONFIG.autoApplySystemPreferences.reducedTransparency&&systemPreferences.prefersReducedTransparency&&(a=!0,document.documentElement.setAttribute('data-reduced-transparency','true')),document.querySelectorAll('.paperplane-reduce-motion-js').forEach(t=>{t.setAttribute('aria-checked',e?'false':'true'),updateSwitchLabel(t)}),document.querySelectorAll('.paperplane-darkmode-js').forEach(e=>{e.setAttribute('aria-checked',t?'true':'false'),updateSwitchLabel(e)}),document.querySelectorAll('.paperplane-reduce-transparency-js').forEach(e=>{e.setAttribute('aria-checked',a?'true':'false'),updateSwitchLabel(e)}),!localStorage.getItem(PREFERENCES_KEY))try{const r={reduced_motion:e?0:1,dark_mode:t?1:0,reduced_transparency:a?1:0};localStorage.setItem(PREFERENCES_KEY,JSON.stringify(r));const n=addHours(new Date,8760);document.cookie=COOKIE_NAME+"="+encodeURIComponent(JSON.stringify(r))+"; expires="+n.toUTCString()+"; path=/; SameSite=Lax"+('https:'===window.location.protocol?"; Secure":"")}catch(e){console.warn('Impossibile inizializzare localStorage/cookie:',e)}}window.ThemeConfig=window.ThemeConfig||{animation:{duration:500,durationCounter:1500}},document.addEventListener('DOMContentLoaded',(function(){syncButtonsWithCurrentDOM(),updateAttributesFromPreferences(),window.ThemeConfig.animation.duration,window.ThemeConfig.animation.durationCounter,document.addEventListener('click',(function(e){e.target.closest('.paperplane-reduce-motion-js')&&(savePreference('reduced_motion',0===getPreferencesFromStorage().reduced_motion?1:0),e.preventDefault())})),document.addEventListener('click',(function(e){e.target.closest('.paperplane-darkmode-js')&&(savePreference('dark_mode',1===getPreferencesFromStorage().dark_mode?0:1),e.preventDefault())})),document.addEventListener('click',(function(e){e.target.closest('.paperplane-reduce-transparency-js')&&(savePreference('reduced_transparency',1===getPreferencesFromStorage().reduced_transparency?0:1),e.preventDefault())})),document.addEventListener('click',(function(e){const t=e.target.closest('.animation-play-pause-js');if(t){const a=t.getAttribute('data-video-stop'),r=document.getElementById(a);r&&(r.paused?(r.play(),t.classList.add('pause'),t.classList.remove('play'),t.setAttribute('aria-pressed','true')):(r.pause(),t.classList.remove('pause'),t.classList.add('play'),t.setAttribute('aria-pressed','false'))),e.preventDefault()}})),document.addEventListener('click',(function(e){const t=e.target.closest('.animation-stop-js:not(.initialized)');if(t){const a=t.getAttribute('data-video-stop'),r=document.getElementById(a);r&&(t.classList.contains('pause')?(r.classList.remove('animate'),t.classList.add('play'),t.classList.remove('pause'),t.setAttribute('aria-pressed','true')):(r.classList.add('animate'),t.classList.remove('play'),t.classList.add('pause'),t.setAttribute('aria-pressed','false'))),e.preventDefault()}})),setTimeout((function(){document.querySelectorAll('.stoppable-js').forEach((function(e){e.pause&&e.pause()})),document.querySelectorAll('.animation-play-pause-js').forEach((function(e){e.classList.remove('pause'),e.classList.add('play'),e.setAttribute('aria-pressed','false')}))}),12e4),window.addEventListener('scroll',(function(){const e=window.scrollY||window.pageYOffset,t=document.querySelectorAll('.reduce-motion-overlay-js');e>200?t.forEach(e=>e.classList.add('hidden')):t.forEach(e=>e.classList.remove('hidden'))})),document.body.addEventListener('keydown',(function(e){9===e.keyCode&&'A'===e.target.tagName&&document.querySelectorAll('.aos-animate').forEach((function(e){e.classList.remove('aos-animate'),e.classList.add('unset-aos-animate')}))})),document.body.addEventListener('keyup',(function(e){9===e.keyCode&&document.querySelectorAll('.unset-aos-animate').forEach((function(e){e.classList.remove('unset-aos-animate'),e.classList.add('aos-animate')}))}))}));