function debounce(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e.apply(this,n),t)}}function getWordVariations(e){const t=new Set([e.toLowerCase()]),o=[{from:/i$/i,to:"o"},{from:/e$/i,to:"a"},{from:/i$/i,to:"e"},{from:/o$/i,to:"i"},{from:/a$/i,to:"e"},{from:/e$/i,to:"i"}],n=[{from:/chi$/i,to:"co"},{from:/che$/i,to:"ca"},{from:/ghi$/i,to:"go"},{from:/ghe$/i,to:"ga"},{from:/co$/i,to:"chi"},{from:/ca$/i,to:"che"},{from:/go$/i,to:"ghi"},{from:/ga$/i,to:"ghe"}];return[...o,...n].forEach(o=>{e.match(o.from)&&t.add(e.replace(o.from,o.to).toLowerCase())}),Array.from(t)}function handleExceptions(e){const t={uomo:"uomini",uomini:"uomo",dio:"dei",dei:"dio",bue:"buoi",buoi:"bue"},o=new Set(["città","virtù","gioventù","caffè","computer","sport"]);return o.has(e.toLowerCase())?[e.toLowerCase()]:t[e.toLowerCase()]?[e.toLowerCase(),t[e.toLowerCase()]]:null}function getNormalizedWords(e){const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),o=handleExceptions(t);return o||getWordVariations(t)}function removeAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}document.addEventListener("DOMContentLoaded",function(){function e(e){const t=searchConfig.postTypePriorities||{},o=parseInt(t[e])||999;return o}async function t(){try{if(searchConfig.gzipUrl)try{const e=await fetch(searchConfig.gzipUrl,{headers:{"Accept-Encoding":"gzip"}});if(e.ok)return await e.json()}catch(e){console.warn("Fallback alla versione non compressa:",e)}const e=await fetch(searchConfig.jsonUrl);if(!e.ok)throw new Error("Errore nel caricamento del JSON");return await e.json()}catch(e){throw console.error("Errore nel caricamento:",e),e}}let o=[];const n=document.getElementById("search-input"),i=document.getElementById("search-suggestions");let r=!1;n&&i?(n.addEventListener("focus",function(){r||t().then(e=>{o=Object.values(e),r=!0}).catch(e=>{console.error("Errore caricamento dati:",e)})}),n.addEventListener("input",debounce(function(t){const r=t.target.value.toLowerCase(),s=n.selectionStart;if(r.length<3)return void i.classList.remove("visible");const c=o.filter(e=>{const t=r.split(" ").filter(e=>e.length>0),o=t.map(e=>getNormalizedWords(e)).flat();e.matchScore=0;const n=t.some(t=>removeAccents(e.title.toLowerCase()).includes(t.toLowerCase()));n&&(e.matchScore+=100);const i=o.some(t=>removeAccents(e.title.toLowerCase()).includes(t));i&&!n&&(e.matchScore+=50);const s=e.searchable_content&&t.some(t=>removeAccents(e.searchable_content.toLowerCase()).includes(t.toLowerCase()));s&&(e.matchScore+=30);const c=e.searchable_content&&o.some(t=>removeAccents(e.searchable_content.toLowerCase()).includes(t));return c&&!s&&(e.matchScore+=10),i||c||n||s}).sort((t,o)=>{const n=e(t.post_type),i=e(o.post_type);return n!==i?n-i:t.matchScore!==o.matchScore?o.matchScore-t.matchScore:new Date(o.modified)-new Date(t.modified)}).slice(0,30);if(c.length>0){const e=c[0].title,t=r.split(" "),o=t[t.length-1],a=e.toLowerCase().split(" "),l=a.find(e=>e.startsWith(o));if(l&&o.length>0){const e=l.slice(o.length),t=n.value;n.value=t+e,n.setSelectionRange(s,n.value.length)}i.innerHTML=c.map(e=>`\n                <div class="suggestion-item">\n                    ${e.featured_image?`<div class="suggestion-image">\n                            <img src="${e.featured_image}" alt="" loading="lazy" decoding="async" />\n                        </div>`:""}\n                    <div class="suggestion-title">${e.title}</div>\n                    <a href="${e.url}" class="absl">\n                        <span class="screen-reader-text">${e.title}</span>\n                    </a>\n                </div>\n            `).join(""),i.classList.add("visible")}else i.classList.remove("visible")},300)),n.addEventListener("keydown",function(e){if("ArrowRight"===e.key){e.preventDefault();const t=window.getSelection();t.toString().length>0&&n.setSelectionRange(n.value.length,n.value.length)}else if("Escape"===e.key){const e=n.selectionStart;n.value=n.value.substring(0,e),i.classList.remove("visible")}}),document.addEventListener("click",function(e){!i||n.contains(e.target)||i.contains(e.target)||i.classList.remove("visible")}),i.addEventListener("focusout",function(e){i.contains(e.relatedTarget)||i.classList.remove("visible")})):console.error("Elementi di ricerca non trovati")});