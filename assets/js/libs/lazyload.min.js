!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).LazyLoad=factory()}(this,(function(){"use strict";function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window,supportsClassList=runningOnBrowser&&"classList"in document.createElement("p"),isHiDpi=runningOnBrowser&&window.devicePixelRatio>1,defaultSettings={elements_selector:".lazy",container:isBot||runningOnBrowser?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},getExtendedSettings=function getExtendedSettings(customSettings){return _extends({},defaultSettings,customSettings)},createInstance=function createInstance(classObj,options){var event,eventString="LazyLoad::Initialized",instance=new classObj(options);try{event=new CustomEvent(eventString,{detail:{instance:instance}})}catch(err){(event=document.createEvent("CustomEvent")).initCustomEvent(eventString,!1,!1,{instance:instance})}window.dispatchEvent(event)},autoInitialize=function autoInitialize(classObj,options){if(options)if(options.length)for(var i=0,optionsItem;optionsItem=options[i];i+=1)createInstance(classObj,optionsItem);else createInstance(classObj,options)},SRC="src",SRCSET="srcset",SIZES="sizes",POSTER="poster",ORIGINALS="llOriginalAttrs",DATA="data",statusLoading="loading",statusLoaded="loaded",statusApplied="applied",statusEntered="entered",statusError="error",statusNative="native",dataPrefix="data-",statusDataName="ll-status",getData=function getData(element,attribute){return element.getAttribute("data-"+attribute)},setData=function setData(element,attribute,value){var attrName="data-"+attribute;null!==value?element.setAttribute(attrName,value):element.removeAttribute(attrName)},getStatus=function getStatus(element){return getData(element,"ll-status")},setStatus=function setStatus(element,status){return setData(element,"ll-status",status)},resetStatus=function resetStatus(element){return setStatus(element,null)},hasEmptyStatus=function hasEmptyStatus(element){return null===getStatus(element)},hasStatusLoading=function hasStatusLoading(element){return"loading"===getStatus(element)},hasStatusError=function hasStatusError(element){return"error"===getStatus(element)},hasStatusNative=function hasStatusNative(element){return"native"===getStatus(element)},statusesAfterLoading=["loading","loaded","applied","error"],hadStartedLoading=function hadStartedLoading(element){return statusesAfterLoading.indexOf(getStatus(element))>=0},safeCallback=function safeCallback(callback,arg1,arg2,arg3){callback&&(void 0===arg3?void 0===arg2?callback(arg1):callback(arg1,arg2):callback(arg1,arg2,arg3))},addClass=function addClass(element,className){supportsClassList?element.classList.add(className):element.className+=(element.className?" ":"")+className},removeClass=function removeClass(element,className){supportsClassList?element.classList.remove(className):element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},addTempImage=function addTempImage(element){element.llTempImage=document.createElement("IMG")},deleteTempImage=function deleteTempImage(element){delete element.llTempImage},getTempImage=function getTempImage(element){return element.llTempImage},unobserve=function unobserve(element,instance){if(instance){var observer=instance._observer;observer&&observer.unobserve(element)}},resetObserver=function resetObserver(observer){observer.disconnect()},unobserveEntered=function unobserveEntered(element,settings,instance){settings.unobserve_entered&&unobserve(element,instance)},updateLoadingCount=function updateLoadingCount(instance,delta){instance&&(instance.loadingCount+=delta)},decreaseToLoadCount=function decreaseToLoadCount(instance){instance&&(instance.toLoadCount-=1)},setToLoadCount=function setToLoadCount(instance,value){instance&&(instance.toLoadCount=value)},isSomethingLoading=function isSomethingLoading(instance){return instance.loadingCount>0},haveElementsToLoad=function haveElementsToLoad(instance){return instance.toLoadCount>0},getSourceTags=function getSourceTags(parentTag){for(var sourceTags=[],i=0,childTag;childTag=parentTag.children[i];i+=1)"SOURCE"===childTag.tagName&&sourceTags.push(childTag);return sourceTags},forEachPictureSource=function forEachPictureSource(element,fn){var parent=element.parentNode,sourceTags;parent&&"PICTURE"===parent.tagName&&getSourceTags(parent).forEach(fn)},forEachVideoSource=function forEachVideoSource(element,fn){var sourceTags;getSourceTags(element).forEach(fn)},attrsSrc=[SRC],attrsSrcPoster=[SRC,POSTER],attrsSrcSrcsetSizes=[SRC,SRCSET,SIZES],attrsData=[DATA],hasOriginalAttrs=function hasOriginalAttrs(element){return!!element[ORIGINALS]},getOriginalAttrs=function getOriginalAttrs(element){return element[ORIGINALS]},deleteOriginalAttrs=function deleteOriginalAttrs(element){return delete element[ORIGINALS]},setOriginalsObject=function setOriginalsObject(element,attributes){if(!hasOriginalAttrs(element)){var originals={};attributes.forEach((function(attribute){originals[attribute]=element.getAttribute(attribute)})),element[ORIGINALS]=originals}},saveOriginalBackgroundStyle=function saveOriginalBackgroundStyle(element){hasOriginalAttrs(element)||(element[ORIGINALS]={backgroundImage:element.style.backgroundImage})},setOrResetAttribute=function setOrResetAttribute(element,attrName,value){value?element.setAttribute(attrName,value):element.removeAttribute(attrName)},restoreOriginalAttrs=function restoreOriginalAttrs(element,attributes){if(hasOriginalAttrs(element)){var originals=getOriginalAttrs(element);attributes.forEach((function(attribute){setOrResetAttribute(element,attribute,originals[attribute])}))}},restoreOriginalBgImage=function restoreOriginalBgImage(element){if(hasOriginalAttrs(element)){var originals=getOriginalAttrs(element);element.style.backgroundImage=originals.backgroundImage}},manageApplied=function manageApplied(element,settings,instance){addClass(element,settings.class_applied),setStatus(element,"applied"),instance&&(settings.unobserve_completed&&unobserve(element,settings),safeCallback(settings.callback_applied,element,instance))},manageLoading=function manageLoading(element,settings,instance){addClass(element,settings.class_loading),setStatus(element,"loading"),instance&&(updateLoadingCount(instance,1),safeCallback(settings.callback_loading,element,instance))},setAttributeIfValue=function setAttributeIfValue(element,attrName,value){value&&element.setAttribute(attrName,value)},setImageAttributes=function setImageAttributes(element,settings){setAttributeIfValue(element,SIZES,getData(element,settings.data_sizes)),setAttributeIfValue(element,SRCSET,getData(element,settings.data_srcset)),setAttributeIfValue(element,SRC,getData(element,settings.data_src))},setSourcesImg,setSourcesIframe,setSourcesVideo,setSourcesObject,setBackground=function setBackground(element,settings,instance){var bg1xValue=getData(element,settings.data_bg),bgHiDpiValue=getData(element,settings.data_bg_hidpi),bgDataValue=isHiDpi&&bgHiDpiValue?bgHiDpiValue:bg1xValue;bgDataValue&&(element.style.backgroundImage='url("'.concat(bgDataValue,'")'),getTempImage(element).setAttribute(SRC,bgDataValue),manageLoading(element,settings,instance))},setMultiBackground=function setMultiBackground(element,settings,instance){var bg1xValue=getData(element,settings.data_bg_multi),bgHiDpiValue=getData(element,settings.data_bg_multi_hidpi),bgDataValue=isHiDpi&&bgHiDpiValue?bgHiDpiValue:bg1xValue;bgDataValue&&(element.style.backgroundImage=bgDataValue,manageApplied(element,settings,instance))},setImgsetBackground=function setImgsetBackground(element,settings,instance){var bgImgSetDataValue=getData(element,settings.data_bg_set);if(bgImgSetDataValue){var imgSetValues=bgImgSetDataValue.split("|"),bgImageValues=imgSetValues.map((function(value){return"image-set(".concat(value,")")}));element.style.backgroundImage=bgImageValues.join(),""===element.style.backgroundImage&&(bgImageValues=imgSetValues.map((function(value){return"-webkit-image-set(".concat(value,")")})),element.style.backgroundImage=bgImageValues.join()),manageApplied(element,settings,instance)}},setSourcesFunctions={IMG:function setSourcesImg(imgEl,settings){forEachPictureSource(imgEl,(function(sourceTag){setOriginalsObject(sourceTag,attrsSrcSrcsetSizes),setImageAttributes(sourceTag,settings)})),setOriginalsObject(imgEl,attrsSrcSrcsetSizes),setImageAttributes(imgEl,settings)},IFRAME:function setSourcesIframe(iframe,settings){setOriginalsObject(iframe,attrsSrc),setAttributeIfValue(iframe,SRC,getData(iframe,settings.data_src))},VIDEO:function setSourcesVideo(videoEl,settings){forEachVideoSource(videoEl,(function(sourceEl){setOriginalsObject(sourceEl,attrsSrc),setAttributeIfValue(sourceEl,SRC,getData(sourceEl,settings.data_src))})),setOriginalsObject(videoEl,attrsSrcPoster),setAttributeIfValue(videoEl,POSTER,getData(videoEl,settings.data_poster)),setAttributeIfValue(videoEl,SRC,getData(videoEl,settings.data_src)),videoEl.load()},OBJECT:function setSourcesObject(object,settings){setOriginalsObject(object,attrsData),setAttributeIfValue(object,DATA,getData(object,settings.data_src))}},setSourcesNative=function setSourcesNative(element,settings){var setSourcesFunction=setSourcesFunctions[element.tagName];setSourcesFunction&&setSourcesFunction(element,settings)},setSources=function setSources(element,settings,instance){var setSourcesFunction=setSourcesFunctions[element.tagName];setSourcesFunction&&(setSourcesFunction(element,settings),manageLoading(element,settings,instance))},elementsWithLoadEvent=["IMG","IFRAME","VIDEO","OBJECT"],hasLoadEvent=function hasLoadEvent(element){return elementsWithLoadEvent.indexOf(element.tagName)>-1},checkFinish=function checkFinish(settings,instance){!instance||isSomethingLoading(instance)||haveElementsToLoad(instance)||safeCallback(settings.callback_finish,instance)},addEventListener=function addEventListener(element,eventName,handler){element.addEventListener(eventName,handler),element.llEvLisnrs[eventName]=handler},removeEventListener=function removeEventListener(element,eventName,handler){element.removeEventListener(eventName,handler)},hasEventListeners=function hasEventListeners(element){return!!element.llEvLisnrs},addEventListeners=function addEventListeners(element,loadHandler,errorHandler){hasEventListeners(element)||(element.llEvLisnrs={});var loadEventName="VIDEO"===element.tagName?"loadeddata":"load";addEventListener(element,loadEventName,loadHandler),addEventListener(element,"error",errorHandler)},removeEventListeners=function removeEventListeners(element){if(hasEventListeners(element)){var eventListeners=element.llEvLisnrs;for(var eventName in eventListeners){var handler=eventListeners[eventName];removeEventListener(element,eventName,handler)}delete element.llEvLisnrs}},doneHandler=function doneHandler(element,settings,instance){deleteTempImage(element),updateLoadingCount(instance,-1),decreaseToLoadCount(instance),removeClass(element,settings.class_loading),settings.unobserve_completed&&unobserve(element,instance)},loadHandler=function loadHandler(event,element,settings,instance){var goingNative=hasStatusNative(element);doneHandler(element,settings,instance),addClass(element,settings.class_loaded),setStatus(element,"loaded"),safeCallback(settings.callback_loaded,element,instance),goingNative||checkFinish(settings,instance)},errorHandler=function errorHandler(event,element,settings,instance){var goingNative=hasStatusNative(element);doneHandler(element,settings,instance),addClass(element,settings.class_error),setStatus(element,"error"),safeCallback(settings.callback_error,element,instance),settings.restore_on_error&&restoreOriginalAttrs(element,attrsSrcSrcsetSizes),goingNative||checkFinish(settings,instance)},addOneShotEventListeners=function addOneShotEventListeners(element,settings,instance){var elementToListenTo=getTempImage(element)||element,_loadHandler,_errorHandler;hasEventListeners(elementToListenTo)||addEventListeners(elementToListenTo,(function _loadHandler(event){loadHandler(event,element,settings,instance),removeEventListeners(elementToListenTo)}),(function _errorHandler(event){errorHandler(event,element,settings,instance),removeEventListeners(elementToListenTo)}))},loadBackground=function loadBackground(element,settings,instance){addTempImage(element),addOneShotEventListeners(element,settings,instance),saveOriginalBackgroundStyle(element),setBackground(element,settings,instance),setMultiBackground(element,settings,instance),setImgsetBackground(element,settings,instance)},loadRegular=function loadRegular(element,settings,instance){addOneShotEventListeners(element,settings,instance),setSources(element,settings,instance)},load=function load(element,settings,instance){hasLoadEvent(element)?loadRegular(element,settings,instance):loadBackground(element,settings,instance)},loadNative=function loadNative(element,settings,instance){element.setAttribute("loading","lazy"),addOneShotEventListeners(element,settings,instance),setSourcesNative(element,settings),setStatus(element,"native")},removeImageAttributes=function removeImageAttributes(element){element.removeAttribute(SRC),element.removeAttribute(SRCSET),element.removeAttribute(SIZES)},resetSourcesImg=function resetSourcesImg(element){forEachPictureSource(element,(function(sourceTag){removeImageAttributes(sourceTag)})),removeImageAttributes(element)},restoreImg=function restoreImg(imgEl){forEachPictureSource(imgEl,(function(sourceEl){restoreOriginalAttrs(sourceEl,attrsSrcSrcsetSizes)})),restoreOriginalAttrs(imgEl,attrsSrcSrcsetSizes)},restoreVideo,restoreIframe,restoreObject,restoreFunctions={IMG:restoreImg,IFRAME:function restoreIframe(iframeEl){restoreOriginalAttrs(iframeEl,attrsSrc)},VIDEO:function restoreVideo(videoEl){forEachVideoSource(videoEl,(function(sourceEl){restoreOriginalAttrs(sourceEl,attrsSrc)})),restoreOriginalAttrs(videoEl,attrsSrcPoster),videoEl.load()},OBJECT:function restoreObject(objectEl){restoreOriginalAttrs(objectEl,attrsData)}},restoreAttributes=function restoreAttributes(element){var restoreFunction=restoreFunctions[element.tagName];restoreFunction?restoreFunction(element):restoreOriginalBgImage(element)},resetClasses=function resetClasses(element,settings){hasEmptyStatus(element)||hasStatusNative(element)||(removeClass(element,settings.class_entered),removeClass(element,settings.class_exited),removeClass(element,settings.class_applied),removeClass(element,settings.class_loading),removeClass(element,settings.class_loaded),removeClass(element,settings.class_error))},restore=function restore(element,settings){restoreAttributes(element),resetClasses(element,settings),resetStatus(element),deleteOriginalAttrs(element)},cancelLoading=function cancelLoading(element,entry,settings,instance){settings.cancel_on_exit&&hasStatusLoading(element)&&"IMG"===element.tagName&&(removeEventListeners(element),resetSourcesImg(element),restoreImg(element),removeClass(element,settings.class_loading),updateLoadingCount(instance,-1),resetStatus(element),safeCallback(settings.callback_cancel,element,entry,instance))},onEnter=function onEnter(element,entry,settings,instance){var dontLoad=hadStartedLoading(element);setStatus(element,"entered"),addClass(element,settings.class_entered),removeClass(element,settings.class_exited),unobserveEntered(element,settings,instance),safeCallback(settings.callback_enter,element,entry,instance),dontLoad||load(element,settings,instance)},onExit=function onExit(element,entry,settings,instance){hasEmptyStatus(element)||(addClass(element,settings.class_exited),cancelLoading(element,entry,settings,instance),safeCallback(settings.callback_exit,element,entry,instance))},tagsWithNativeLazy=["IMG","IFRAME","VIDEO"],shouldUseNative=function shouldUseNative(settings){return settings.use_native&&"loading"in HTMLImageElement.prototype},loadAllNative=function loadAllNative(elements,settings,instance){elements.forEach((function(element){-1!==tagsWithNativeLazy.indexOf(element.tagName)&&loadNative(element,settings,instance)})),setToLoadCount(instance,0)},isIntersecting=function isIntersecting(entry){return entry.isIntersecting||entry.intersectionRatio>0},getObserverSettings=function getObserverSettings(settings){return{root:settings.container===document?null:settings.container,rootMargin:settings.thresholds||settings.threshold+"px"}},intersectionHandler=function intersectionHandler(entries,settings,instance){entries.forEach((function(entry){return isIntersecting(entry)?onEnter(entry.target,entry,settings,instance):onExit(entry.target,entry,settings,instance)}))},observeElements=function observeElements(observer,elements){elements.forEach((function(element){observer.observe(element)}))},updateObserver=function updateObserver(observer,elementsToObserve){resetObserver(observer),observeElements(observer,elementsToObserve)},setObserver=function setObserver(settings,instance){supportsIntersectionObserver&&!shouldUseNative(settings)&&(instance._observer=new IntersectionObserver((function(entries){intersectionHandler(entries,settings,instance)}),getObserverSettings(settings)))},toArray=function toArray(nodeSet){return Array.prototype.slice.call(nodeSet)},queryElements=function queryElements(settings){return settings.container.querySelectorAll(settings.elements_selector)},excludeManagedElements=function excludeManagedElements(elements){return toArray(elements).filter(hasEmptyStatus)},hasError=function hasError(element){return hasStatusError(element)},filterErrorElements=function filterErrorElements(elements){return toArray(elements).filter(hasError)},getElementsToLoad=function getElementsToLoad(elements,settings){return excludeManagedElements(elements||queryElements(settings))},retryLazyLoad=function retryLazyLoad(settings,instance){var errorElements;filterErrorElements(queryElements(settings)).forEach((function(element){removeClass(element,settings.class_error),resetStatus(element)})),instance.update()},setOnlineCheck=function setOnlineCheck(settings,instance){runningOnBrowser&&(instance._onlineHandler=function(){retryLazyLoad(settings,instance)},window.addEventListener("online",instance._onlineHandler))},resetOnlineCheck=function resetOnlineCheck(instance){runningOnBrowser&&window.removeEventListener("online",instance._onlineHandler)},LazyLoad=function LazyLoad(customSettings,elements){var settings=getExtendedSettings(customSettings);this._settings=settings,this.loadingCount=0,setObserver(settings,this),setOnlineCheck(settings,this),this.update(elements)};return LazyLoad.prototype={update:function update(givenNodeset){var settings=this._settings,elementsToLoad=getElementsToLoad(givenNodeset,settings);setToLoadCount(this,elementsToLoad.length),!isBot&&supportsIntersectionObserver?shouldUseNative(settings)?loadAllNative(elementsToLoad,settings,this):updateObserver(this._observer,elementsToLoad):this.loadAll(elementsToLoad)},destroy:function destroy(){this._observer&&this._observer.disconnect(),resetOnlineCheck(this),queryElements(this._settings).forEach((function(element){deleteOriginalAttrs(element)})),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function loadAll(elements){var _this=this,settings=this._settings,elementsToLoad;getElementsToLoad(elements,settings).forEach((function(element){unobserve(element,_this),load(element,settings,_this)}))},restoreAll:function restoreAll(){var settings=this._settings;queryElements(settings).forEach((function(element){restore(element,settings)}))}},LazyLoad.load=function(element,customSettings){var settings=getExtendedSettings(customSettings);load(element,settings)},LazyLoad.resetStatus=function(element){resetStatus(element)},runningOnBrowser&&autoInitialize(LazyLoad,window.lazyLoadOptions),LazyLoad}));